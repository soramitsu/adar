"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[649],{50649:function(t,e,r){r.r(e),r.d(e,{default:function(){return k}});var o=r(23166),s=(r(70560),r(97582)),i=r(99278),n=r(37981),a=r(86424),d=r(89445),l=r(89334),c=r(68282),u=r(69781),h=r(49053);let m=class extends((0,d.Wr)(l.Z,a.tA.LoadingMixin,a.tA.FormattedAmountMixin)){constructor(...t){super(...t),(0,o.Z)(this,"limitOrderType",void 0),(0,o.Z)(this,"asks",void 0),(0,o.Z)(this,"bids",void 0),(0,o.Z)(this,"quoteAsset",void 0),(0,o.Z)(this,"orderBookLastDeal",void 0),(0,o.Z)(this,"currentOrderBook",void 0),(0,o.Z)(this,"orderBookId",void 0),(0,o.Z)(this,"nodeIsConnected",void 0),(0,o.Z)(this,"exchangeRate",void 0),(0,o.Z)(this,"currencySymbol",void 0),(0,o.Z)(this,"setQuoteValue",void 0),(0,o.Z)(this,"setSide",void 0),(0,o.Z)(this,"subscribeToBidsAndAsks",void 0),(0,o.Z)(this,"PriceVariant",i.PriceVariant),(0,o.Z)(this,"maxRowsNumber",11),(0,o.Z)(this,"selectedStep",""),(0,o.Z)(this,"scalerOpen",!1)}setSteps(){this.selectedStep=this.currentOrderBook?.tickSize.toString()}async updateSubscription(){await this.withLoading((async()=>{await this.withParentLoading((async()=>{await this.subscribeToBidsAndAsks()}))}))}handleSelectStep(t){this.selectedStep=t}fillPrice(t,e){this.isMarketOrder||(this.setSide(e),this.setQuoteValue(Number(t).toString()))}get isMarketOrder(){return this.limitOrderType===c.b8.market}get averagePrice(){return(this.asks?.[0]??this.bids?.[0])?.[0]}get averagePricePrecision(){if(!this.averagePrice)return;const t=this.averagePrice;let e=t,r=n.FPNumber.ONE;if(t.isLessThan(n.FPNumber.ONE)){const o=new n.FPNumber(.1);for(r=o;e.isLessThan(n.FPNumber.ONE)&&(e=t.div(r),!e.isGreaterThanOrEqualTo(n.FPNumber.ONE));)r=r.mul(o)}else if(t.isGreaterThan(n.FPNumber.TEN)){const o=n.FPNumber.TEN;for(r=o;e.isGreaterThan(n.FPNumber.ONE)&&(e=t.div(r),!e.isLessThan(n.FPNumber.TEN));)r=r.mul(o)}return r.toNumber()}get steps(){const t=[],e=this.currentOrderBook?.tickSize;if(!this.averagePricePrecision||!e)return t;for(let r=new n.FPNumber(this.averagePricePrecision??1);r.isGreaterThanOrEqualTo(e);)t.push(r.toString()),r=r.div(n.FPNumber.TEN);return t.slice(-6)}get showAggregationOptions(){return!(!this.asks?.length||!this.bids?.length)}get lastDealTrendsUp(){return this.orderBookLastDeal?.side===i.PriceVariant.Buy}get iconTrend(){return this.lastDealTrendsUp?"arrows-arrow-bold-top-24":"arrows-arrow-bold-bottom-24"}get lastDealPrice(){return this.orderBookLastDeal?.price??n.FPNumber.ZERO}get lastPriceFormatted(){return this.lastDealPrice.toLocaleString()}get fiatValue(){if(!this.quoteAsset)return c.m8;const t=this.getFiatAmount(this.lastDealPrice.toString(),this.quoteAsset)||"0",e=new n.FPNumber(t).mul(this.exchangeRate).toLocaleString();return e?`${this.currencySymbol}${e}`:""}getComputedClassTrend(){const t=["stock-book-delimiter"];return this.lastDealTrendsUp?t.push("stock-book-delimiter--up"):t.push("stock-book-delimiter--down"),t.join(" ")}get asksFormatted(){return this.formatPriceVolumes(this.asks)}get bidsFormatted(){return this.formatPriceVolumes(this.bids)}get sellOrders(){return this.asksFormatted.slice(-this.maxRowsNumber)}get buyOrders(){return this.bidsFormatted.slice(0,this.maxRowsNumber)}getHeight(){return`height: ${24*(this.asksFormatted.length<this.maxRowsNumber?this.maxRowsNumber-this.asksFormatted.length:0)}px`}getStyles(t){return`width: ${t}%`}isBookPrecisionEqual(t){return t===this.currentOrderBook?.tickSize?.toString()}recalcFilledValue(t){if(!t.length)return[];const e=t.map((t=>new n.FPNumber(t.amount))),r=n.FPNumber.max(...e);return t.map((t=>({...t,filled:this.getAmountProportion(new n.FPNumber(t.amount),r)})))}calculateStepsDistribution(t,e=10){return t}get bookPrecision(){return this.currentOrderBook?.tickSize?.toLocaleString()?.split(n.FPNumber.DELIMITERS_CONFIG.decimal)[1]?.length||0}get amountPrecision(){return this.currentOrderBook?.stepLotSize?.toLocaleString()?.split(n.FPNumber.DELIMITERS_CONFIG.decimal)[1]?.length||0}getAmountProportion(t,e){return t.div(e).mul(n.FPNumber.HUNDRED).toNumber()}toBookPrecision(t){return t.toNumber().toFixed(this.bookPrecision)}toAmountPrecision(t){return t.toNumber().toFixed(this.amountPrecision)}formatPriceVolumes(t){if(!this.selectedStep)return[];const e=this.calculateStepsDistribution(t,Number(this.selectedStep)),r=n.FPNumber.max(...e.map((t=>t[1]))),o=[];return e.forEach((t=>{const[e,s,i]=t;if(s.isZero())return;const n=this.isBookPrecisionEqual(this.selectedStep)?e.mul(s):i;o.push({price:this.toBookPrecision(e),amount:this.toAmountPrecision(s),total:this.toBookPrecision(n),filled:this.getAmountProportion(s,r)})})),o}};(0,s.gn)([h.SB.orderBook.limitOrderType],m.prototype,"limitOrderType",void 0),(0,s.gn)([h.SB.orderBook.asks],m.prototype,"asks",void 0),(0,s.gn)([h.SB.orderBook.bids],m.prototype,"bids",void 0),(0,s.gn)([h.Yn.orderBook.quoteAsset],m.prototype,"quoteAsset",void 0),(0,s.gn)([h.Yn.orderBook.orderBookLastDeal],m.prototype,"orderBookLastDeal",void 0),(0,s.gn)([h.Yn.orderBook.currentOrderBook],m.prototype,"currentOrderBook",void 0),(0,s.gn)([h.Yn.orderBook.orderBookId],m.prototype,"orderBookId",void 0),(0,s.gn)([h.Yn.settings.nodeIsConnected],m.prototype,"nodeIsConnected",void 0),(0,s.gn)([h.Yn.wallet.settings.exchangeRate],m.prototype,"exchangeRate",void 0),(0,s.gn)([h.Yn.wallet.settings.currencySymbol],m.prototype,"currencySymbol",void 0),(0,s.gn)([h.QF.orderBook.setQuoteValue],m.prototype,"setQuoteValue",void 0),(0,s.gn)([h.QF.orderBook.setSide],m.prototype,"setSide",void 0),(0,s.gn)([h.aD.orderBook.subscribeToBidsAndAsks],m.prototype,"subscribeToBidsAndAsks",void 0),(0,s.gn)([(0,d.RL)("currentOrderBook",{immediate:!0})],m.prototype,"setSteps",null),(0,s.gn)([(0,d.RL)("orderBookId",{immediate:!0}),(0,d.RL)("nodeIsConnected")],m.prototype,"updateSubscription",null),m=(0,s.gn)([(0,d.wA)({components:{BaseWidget:(0,u.kF)(c.z8.BaseWidget)}})],m);var p=m,k=(0,r(1001).Z)(p,(function(){var t=this,e=t._self._c;t._self._setupProxy;return e("base-widget",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"stock-book book",attrs:{extensive:"",title:t.t("orderBook.orderBook"),tooltip:t.t("orderBook.tooltip.bookWidget")},scopedSlots:t._u([{key:"filters",fn:function(){return[t._e()]},proxy:!0}])},[e("div",{staticClass:"book-columns"},[e("div",[t._v(t._s(t.t("orderBook.price")))]),e("div",[t._v(t._s(t.t("orderBook.amount")))]),e("div",[t._v(t._s(t.t("orderBook.total")))])]),t.asksFormatted.length?e("div",{staticClass:"stock-book-sell",class:{unclickable:t.isMarketOrder}},[e("div",{staticClass:"margin",style:t.getHeight()}),t._l(t.sellOrders,(function(r){return e("div",{key:r.price,staticClass:"row",on:{click:function(e){return t.fillPrice(r.price,t.PriceVariant.Sell)}}},[e("span",{staticClass:"order-info total"},[t._v(t._s(r.total))]),e("span",{staticClass:"order-info amount"},[t._v(t._s(r.amount))]),e("span",{staticClass:"order-info price"},[t._v(t._s(r.price))]),e("div",{staticClass:"bar",style:t.getStyles(r.filled)})])}))],2):e("div",{staticClass:"stock-book-sell--no-asks"},[t._v(t._s(t.t("orderBook.book.noAsks")))]),e("div",{class:t.getComputedClassTrend()},[e("div",[e("span",{staticClass:"mark-price"},[t._v(t._s(t.lastPriceFormatted))]),e("s-icon",{staticClass:"trend-icon",attrs:{name:t.iconTrend,size:"18"}}),e("span",{staticClass:"last-traded-price"},[t._v(t._s(t.fiatValue))])],1)]),t.bidsFormatted.length?e("div",{staticClass:"stock-book-buy",class:{unclickable:t.isMarketOrder}},t._l(t.buyOrders,(function(r){return e("div",{key:r.price,staticClass:"row",on:{click:function(e){return t.fillPrice(r.price,t.PriceVariant.Buy)}}},[e("span",{staticClass:"order-info total"},[t._v(t._s(r.total))]),e("span",{staticClass:"order-info amount"},[t._v(t._s(r.amount))]),e("span",{staticClass:"order-info price"},[t._v(t._s(r.price))]),e("div",{staticClass:"bar",style:t.getStyles(r.filled)})])})),0):e("div",{staticClass:"stock-book-buy--no-bids"},[t._v(t._s(t.t("orderBook.book.noBids")))])])}),[],!1,null,null,null).exports}}]);