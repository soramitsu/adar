"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[7888],{67888:function(t,e,s){s.r(e),s.d(e,{default:function(){return g}});var i=s(23166),r=s(97582),a=s(37981),o=s(69826),n=s(86424),l=s(89445),u=s(68282),b=s(94503),h=s(87550),p=s(35681),d=s(69781),v=s(49053),y=s(50961);let c=class extends((0,l.Wr)(n.tA.TransactionMixin,n.tA.DialogMixin,n.tA.FormattedAmountMixin)){constructor(...t){super(...t),(0,i.Z)(this,"xorSymbol",o.XOR.symbol),(0,i.Z)(this,"getLtvStatus",p.D),(0,i.Z)(this,"debtInput",void 0),(0,i.Z)(this,"vault",void 0),(0,i.Z)(this,"debtAsset",void 0),(0,i.Z)(this,"prevLtv",void 0),(0,i.Z)(this,"maxSafeDebt",void 0),(0,i.Z)(this,"maxLtv",void 0),(0,i.Z)(this,"networkFees",void 0),(0,i.Z)(this,"accountXor",void 0),(0,i.Z)(this,"repayDebtValue","")}async handleDialogVisibility(t){await this.$nextTick(),this.repayDebtValue="",this.debtInput?.focus()}get xorBalance(){return this.getFPNumberFromCodec(this.accountXor?.balance?.transferable??u.m8)}get title(){return this.t("kensetsu.repayDebt")}get networkFee(){return this.networkFees[a.Operation.CreateVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isRepayDebtZero(){return(0,y.yA)(this.repayDebtValue)}get repayDebtFp(){return this.isRepayDebtZero?this.Zero:this.getFPNumber(this.repayDebtValue)}get isRepayMoreThanDebt(){return this.debt.lt(this.repayDebtFp)}get isInsufficientBalance(){return!this.debtAsset||(0,y.Vl)(this.debtAsset,this.repayDebtValue,this.networkFee)}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isRepayDebtZero||this.isRepayMoreThanDebt||this.isInsufficientBalance}get debtAssetBalance(){return(0,y.rh)(this.debtAsset)}get debtAssetBalanceFp(){return this.getFPNumberFromCodec(this.debtAssetBalance,this.debtAsset?.decimals)}get debt(){return this.vault?.debt??this.Zero}get isMaxRepayAvailable(){return!(!this.shouldBalanceBeHidden&&!this.isRepayDebtZero)||!(!this.debt.isFinity()||this.debt.isLteZero())&&!this.repayDebtFp.isEqualTo(this.debt)}get debtSymbol(){return this.debtAsset?.symbol??""}get formattedPrevBorrow(){return this.vault?.debt.toLocaleString()??u.m8}get nextBorrow(){const t=this.vault?.debt;if(this.isRepayDebtZero)return t;const e=t?.sub(this.repayDebtValue);return e?.isGteZero()?e:this.Zero}get formattedNextBorrow(){return this.nextBorrow?.toLocaleString()??u.m8}get formattedPrevLtv(){return this.prevLtv?.toLocaleString(2)??u.m8}get ltvCoeff(){return this.nextBorrow?this.nextBorrow.div(this.maxSafeDebt):null}get ltv(){return this.ltvCoeff?.isFinity()?this.ltvCoeff.mul(u.Tv):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):u.m8}get ltvText(){return b.ho[(0,p.D)(this.ltvNumber)]}get maxInputRepay(){return this.debt.gt(this.debtAssetBalanceFp)?this.debtAssetBalanceFp:this.debt}get repayDebtValuePercent(){if(!this.repayDebtValue)return 0;const t=this.repayDebtFp.div(this.maxInputRepay).mul(u.Tv).toNumber(0);return t>u.Tv?u.Tv:t}handleMaxRepayDebtValue(){this.repayDebtValue=this.maxInputRepay.toString()}handleRepayPercentChange(t){this.repayDebtValue=this.maxInputRepay.mul(t/u.Tv).toString()}get errorMessage(){let t="";return this.isInsufficientXorForFee?t=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isRepayDebtZero?t=this.t("kensetsu.error.enterRepayDebt"):this.isRepayMoreThanDebt?t=this.t("kensetsu.error.repayMoreThanDebt"):this.isInsufficientBalance&&(t=this.t("insufficientBalanceText",{tokenSymbol:this.debtSymbol})),t}async handleRepayDebt(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications((async()=>{if(!this.vault||!this.debtAsset)throw new Error("[api.kensetsu.repayVaultDebt]: vault is null");await n.hi.kensetsu.repayVaultDebt(this.vault,this.repayDebtValue,this.debtAsset)})),this.$emit("confirm")}catch(t){console.error(t)}this.isVisible=!1}};(0,r.gn)([(0,l.Rl)("debtInput")],c.prototype,"debtInput",void 0),(0,r.gn)([(0,l.fI)({type:Object,default:u.u8})],c.prototype,"vault",void 0),(0,r.gn)([(0,l.fI)({type:Object,default:u.u8})],c.prototype,"debtAsset",void 0),(0,r.gn)([(0,l.fI)({type:Object,default:()=>a.FPNumber.ZERO})],c.prototype,"prevLtv",void 0),(0,r.gn)([(0,l.fI)({type:Object,default:()=>a.FPNumber.ZERO})],c.prototype,"maxSafeDebt",void 0),(0,r.gn)([(0,l.fI)({type:Number,default:u.Tv})],c.prototype,"maxLtv",void 0),(0,r.gn)([v.SB.wallet.settings.networkFees],c.prototype,"networkFees",void 0),(0,r.gn)([v.Yn.assets.xor],c.prototype,"accountXor",void 0),(0,r.gn)([(0,l.RL)("visible")],c.prototype,"handleDialogVisibility",null),c=(0,r.gn)([(0,l.wA)({components:{DialogBase:n.wx.DialogBase,InfoLine:n.wx.InfoLine,TokenInput:(0,d.kF)(u.z8.TokenInput),ValueStatus:(0,d.kF)(u.z8.ValueStatusWrapper),PrevNextInfoLine:(0,h.rP)(b.JB.PrevNextInfoLine)}})],c);var f=c,g=(0,s(1001).Z)(f,(function(){var t=this,e=t._self._c;t._self._setupProxy;return e("dialog-base",{attrs:{title:t.title,visible:t.isVisible,tooltip:t.t("kensetsu.repayDebtDescription")},on:{"update:visible":function(e){t.isVisible=e}}},[e("div",{staticClass:"repay-debt"},[e("token-input",{ref:"debtInput",staticClass:"repay-debt__debt-input repay-debt__token-input",attrs:{"with-slider":"",title:t.title,"is-fiat-editable":"","is-max-available":t.isMaxRepayAvailable,token:t.debtAsset,balance:t.debtAssetBalance,"slider-value":t.repayDebtValuePercent,disabled:t.loading},on:{max:t.handleMaxRepayDebtValue,slide:t.handleRepayPercentChange},model:{value:t.repayDebtValue,callback:function(e){t.repayDebtValue=e},expression:"repayDebtValue"}}),e("prev-next-info-line",{attrs:{label:t.t("kensetsu.outstandingDebt"),tooltip:t.t("kensetsu.outstandingDebtDescription"),symbol:t.debtSymbol,prev:t.formattedPrevBorrow,next:t.formattedNextBorrow}}),e("prev-next-info-line",{attrs:{label:t.t("kensetsu.ltv"),tooltip:t.t("kensetsu.ltvDescription"),symbol:"%",prev:t.formattedPrevLtv,next:t.formattedLtv}},[t.ltv?e("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:t.ltvNumber,getStatus:t.getLtvStatus}},[t._v(" "+t._s(t.ltvText)+" ")]):t._e()],1),e("s-button",{staticClass:"s-typography-button--large action-button repay-debt__button",attrs:{type:"primary",disabled:t.disabled},on:{click:t.handleRepayDebt}},[t.disabled?[t._v(t._s(t.errorMessage))]:[t._v(t._s(t.title))]],2),e("info-line",{attrs:{label:t.t("networkFeeText"),"label-tooltip":t.t("networkFeeTooltipText"),value:t.networkFeeFormatted,"asset-symbol":t.xorSymbol,"fiat-value":t.getFiatAmountByCodecString(t.networkFee),"is-formatted":""}})],1)])}),[],!1,null,"3a9a8a5f",null).exports}}]);