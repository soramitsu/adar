"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[6293],{6293:function(e,r,s){s.r(r),s.d(r,{default:function(){return y}});var t=s(23166),a=s(97582),i=s(86424),n=s(25934),o=s(89445),c=s(89334),d=s(49053),l=s(25825),m=s(50961),h=s(50042);let u=class extends((0,o.Wr)(c.Z,i.tA.NotificationMixin,i.tA.CameraPermissionMixin)){constructor(...e){super(...e),(0,t.Z)(this,"soraNetwork",void 0),(0,t.Z)(this,"source",void 0),(0,t.Z)(this,"referenceNumber",void 0),(0,t.Z)(this,"setReferenceNumber",void 0),(0,t.Z)(this,"accessToken",void 0),(0,t.Z)(this,"loadingKycView",!0),(0,t.Z)(this,"btnLoading",!1),(0,t.Z)(this,"cameraPermission",null)}async getReferenceNumber(e){const r=this.soraNetwork??await(0,m.RP)(),{kycService:s}=(0,h.It)(r),t=localStorage.getItem("PW-token");try{const r=await fetch(e,{method:"POST",body:JSON.stringify({ReferenceID:(0,n.Z)(),MobileNumber:"",Email:"",AddressChanged:!1,DocumentChanged:!1,IbanTypeID:null,CardTypeID:null,AdditionalData:""}),headers:{Authorization:`Bearer ${t}`}});return(await r.json()).ReferenceNumber}catch(e){console.error("[SoraCard]: Error while getting reference number",e),this.showAppNotification(this.t("card.infoMessageTryAgain")),this.$emit("confirm",l.aS.Start),i.Wr.unload(s.sdkURL,!1)}}async updateJwtPairByInterval(){const e=async()=>{const e=localStorage.getItem("PW-refresh-token");e&&await(0,h.Xi)(e)};e(),setInterval(e,1191e3)}async requestCameraAccess(){this.btnLoading=!0;try{if(!await this.checkMediaDevicesAllowance("SoraCard"))return;this.cameraPermission="granted"}catch(e){console.error("[SoraCard]: Camera error.",e)}finally{this.btnLoading=!1}this.initKyc()}get hasCameraAccess(){return"granted"===this.cameraPermission}get ISOLanguageName(){return"zh-CN"===this.language?"zh":this.language}get forbiddenByBrowser(){return"denied"===this.cameraPermission}get btnCameraText(){return this.forbiddenByBrowser?this.t("browserPermission.btnGoToSettings"):this.hasCameraAccess?this.t("continueText"):this.t("browserPermission.btnAllow")}async initKyc(){const e=this.soraNetwork??await(0,m.RP)();this.updateJwtPairByInterval();const{kycService:r,soraProxy:s}=(0,h.It)(e),t=this.referenceNumber?this.referenceNumber:await this.getReferenceNumber(s.referenceNumberEndpoint);t&&this.setReferenceNumber(t),await i.Wr.unload(r.sdkURL,!1).catch((()=>{})),i.Wr.load(r.sdkURL).then((()=>{Paywings.WebKyc.create({KycCredentials:{Username:r.username,Password:r.pass,Domain:"soracard.com",env:r.env,UnifiedLoginApiKey:r.unifiedApiKey},KycSettings:{AppReferenceID:(0,n.Z)(),Language:this.ISOLanguageName||"en",ReferenceNumber:t,ElementId:"#kyc",Logo:"",WelcomeHidden:!1,WelcomeTitle:"",DocumentCheckWindowHeight:"50vh",DocumentCheckWindowWidth:"100%",HideLoader:!0},KycUserData:{FirstName:"",MiddleName:"",LastName:"",Email:"",MobileNumber:"",Address1:"",Address2:"",Address3:"",ZipCode:"",City:"",State:"",CountryCode:""},UserCredentials:{AccessToken:localStorage.getItem("PW-token"),RefreshToken:localStorage.getItem("PW-refresh-token")}}).on("Error",(e=>{console.error("[SoraCard]: Error while initiating KYC",e),this.showAppNotification(this.t("card.infoMessageTryAgain")),this.$emit("confirm",l.aS.Start),i.Wr.unload(r.sdkURL)})).on("Success",(async e=>{const s=localStorage.getItem("PW-refresh-token");this.source===i.WALLET_CONSTS.AppWallet.FearlessWallet&&s&&await(window.injectedWeb3?.["fearless-wallet"]?.saveSoraCardToken?.(s)),this.$emit("confirm",l.aS.KycResult),i.Wr.unload(r.sdkURL)}))})).catch((e=>{console.error("[SoraCard]: Error while fetching script",e)})),setTimeout((()=>{this.loadingKycView=!1}),5e3)}async mounted(){try{const{state:e}=await navigator.permissions.query({name:"camera"});if(this.cameraPermission=e,!this.hasCameraAccess)return}catch(e){return void console.error("[SoraCard]: Camera error.",e)}this.initKyc()}};(0,a.gn)([d.SB.wallet.settings.soraNetwork],u.prototype,"soraNetwork",void 0),(0,a.gn)([d.SB.wallet.account.source],u.prototype,"source",void 0),(0,a.gn)([d.SB.soraCard.referenceNumber],u.prototype,"referenceNumber",void 0),(0,a.gn)([d.QF.soraCard.setReferenceNumber],u.prototype,"setReferenceNumber",void 0),(0,a.gn)([(0,o.fI)({default:"",type:String})],u.prototype,"accessToken",void 0),u=(0,a.gn)([o.wA],u);var g=u,y=(0,s(1001).Z)(g,(function(){var e=this,r=e._self._c;e._self._setupProxy;return r("div",{staticClass:"sora-card sora-card-kyc-wrapper"},[e.hasCameraAccess?r("div",[r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingKycView,expression:"loadingKycView"}],staticClass:"sora-card-kyc-view"},[r("s-scrollbar",[r("div",{attrs:{id:"kyc"}}),r("div",{staticStyle:{display:"none"},attrs:{id:"finish"}},[r("div",{staticClass:"alert alert-success"},[e._v("Kyc was successfull, sample integrator response displayed here")])])])],1)]):r("div",{staticClass:"camera-permission"},[r("s-icon",{staticClass:"camera-permission-icon",attrs:{name:"camera-16",size:"48"}}),r("h4",{staticClass:"camera-permission-title"},[e._v(e._s(e.t("browserPermission.title")))]),r("p",{staticClass:"camera-permission-desc"},[e._v(" "+e._s(e.t("browserPermission.desc"))+" ")]),r("div",{staticClass:"camera-permission-disclaimer"},[r("div",{staticClass:"tos__disclaimer"},[r("p",{staticClass:"tos__disclaimer-paragraph"},[e._v(" "+e._s(e.t("browserPermission.disclaimer"))+" ")]),r("div",{staticClass:"tos__disclaimer-warning icon"},[r("s-icon",{attrs:{name:"notifications-alert-triangle-24",size:"28px"}})],1)])]),r("s-button",{staticClass:"camera-permission-btn",attrs:{type:"primary",disabled:e.forbiddenByBrowser,loading:e.btnLoading},on:{click:e.requestCameraAccess}},[e._v(" "+e._s(e.btnCameraText)+" ")])],1)])}),[],!1,null,null,null).exports}}]);