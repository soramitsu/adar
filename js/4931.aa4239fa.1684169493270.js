"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[4931],{54931:function(t,e,s){s.r(e),s.d(e,{default:function(){return k}});var i=s(60760),o=s(70655),a=s(53545),r=s(50576),n=s(36930),c=s(82753),d=s(63280),l=s(41468),u=s(2591),m=s(91487),h=s(74614),g=s(80710),v=s(16546),p=s(85530);let b=class extends((0,a.Wr)(r.tA.FormattedAmountMixin,r.tA.NetworkFeeWarningMixin,r.tA.CopyAddressMixin,d.Z,l.Z,u.Z,m.Z)){constructor(...t){super(...t),(0,i.Z)(this,"delimiters",n.FPNumber.DELIMITERS_CONFIG),(0,i.Z)(this,"KnownSymbols",c.KnownSymbols),(0,i.Z)(this,"evmNetworkFeeFetching",void 0),(0,i.Z)(this,"subNetworks",void 0),(0,i.Z)(this,"amount",void 0),(0,i.Z)(this,"isSoraToEvm",void 0),(0,i.Z)(this,"registeredAssetsFetching",void 0),(0,i.Z)(this,"asset",void 0),(0,i.Z)(this,"isRegisteredAsset",void 0),(0,i.Z)(this,"nodeIsConnected",void 0),(0,i.Z)(this,"setSoraToEvm",void 0),(0,i.Z)(this,"setHistoryId",void 0),(0,i.Z)(this,"setAmount",void 0),(0,i.Z)(this,"setAssetAddress",void 0),(0,i.Z)(this,"resetBridgeForm",void 0),(0,i.Z)(this,"resetBalanceSubscription",void 0),(0,i.Z)(this,"updateBalanceSubscription",void 0),(0,i.Z)(this,"getEvmNetworkFee",void 0),(0,i.Z)(this,"generateHistoryItem",void 0),(0,i.Z)(this,"addAssetToAccountAssets",void 0),(0,i.Z)(this,"showSelectTokenDialog",!1),(0,i.Z)(this,"showSelectNetworkDialog",!1),(0,i.Z)(this,"showConfirmTransactionDialog",!1)}updateConnectionSubsriptions(t){t?this.updateBalanceSubscription():this.resetBalanceSubscription()}get assetAddress(){return this.asset?.address??""}get firstFieldFiatBalance(){return this.isSoraToEvm?this.getFiatBalance(this.asset):void 0}get secondFieldFiatBalance(){return this.isSoraToEvm?void 0:this.getFiatBalance(this.asset)}get isNetworkAConnected(){return this.isSoraToEvm?this.isSoraAccountConnected:this.isExternalAccountConnected}get isNetworkBConnected(){return this.isSoraToEvm?this.isExternalAccountConnected:this.isSoraAccountConnected}get isZeroAmount(){return 0==+this.amount}get isMaxAvailable(){if(!this.areNetworksConnected||!this.isRegisteredAsset||!this.asset)return!1;const t=(0,p.rh)(this.asset,{internal:this.isSoraToEvm});if((0,p.yA)(t))return!1;const e=this.asset.decimals,s=this.getFPNumberFromCodec(t,e),i=this.getFPNumber(this.amount,e);if((0,p.AN)(this.asset)&&this.isSoraToEvm){const t=this.getFPNumberFromCodec(this.soraNetworkFee,e);return!n.FPNumber.eq(t,s.sub(i))&&n.FPNumber.gt(s,t)}if((0,p.uc)(this.asset.externalAddress)&&!this.isSoraToEvm){const t=this.getFPNumberFromCodec(this.evmNetworkFee);return!n.FPNumber.eq(t,s.sub(i))&&n.FPNumber.gt(s,t)}return!n.FPNumber.eq(s,i)}get isInsufficientXorForFee(){return(0,p.LG)(this.xor,this.soraNetworkFee)}get isInsufficientEvmNativeTokenForFee(){return(0,p.lV)(this.evmBalance,this.evmNetworkFee)}get isInsufficientBalance(){if(!this.asset)return!1;const t=this.isSoraToEvm?this.soraNetworkFee:this.evmNetworkFee;return this.isNetworkAConnected&&this.isRegisteredAsset&&(0,p.Vl)(this.asset,this.amount,t,!this.isSoraToEvm)}get isAssetSelected(){return!!this.asset}get assetSymbol(){return this.asset?.symbol??""}get formattedSoraNetworkFee(){return this.formatCodecNumber(this.soraNetworkFee)}get isConfirmTxDisabled(){return!this.isAssetSelected||!this.isRegisteredAsset||!this.areNetworksConnected||!this.isValidNetworkType||this.isZeroAmount||this.isInsufficientXorForFee||this.isInsufficientEvmNativeTokenForFee||this.isInsufficientBalance}get isConfirmTxLoading(){return this.isSelectAssetLoading||this.evmNetworkFeeFetching||this.registeredAssetsFetching}get isXorSufficientForNextOperation(){return!!this.asset&&this.isXorSufficientForNextTx({type:this.isSoraToEvm?n.Operation.EthBridgeOutgoing:n.Operation.EthBridgeIncoming,isXor:(0,p.AN)(this.asset),amount:this.getFPNumber(this.amount)})}getDecimals(t=!0){return t?this.asset?.decimals:this.asset?.externalDecimals}get accountAddressFrom(){return this.isSoraToEvm?this.getWalletAddress():this.evmAddress}get accountAddressTo(){return this.isSoraToEvm?this.evmAddress:this.getWalletAddress()}formatBalance(t=!0){if(!this.isRegisteredAsset||!this.asset)return"-";const e=(0,p.rh)(this.asset,{internal:t});if(!e)return"-";const s=this.getDecimals(t);return this.formatCodecNumber(e,s)}async created(){this.$route.params.xorToDeposit?(await this.selectAsset(this.xor),this.setSoraToEvm(!1),this.setAmount(this.$route.params.xorToDeposit)):this.resetBridgeForm()}destroyed(){this.resetBalanceSubscription()}getBridgeItemTitle(t=!1){return this.formatNetwork(t)}getCopyTooltip(t=!1){return this.copyTooltip(t?this.t("bridge.soraAddress"):this.t("bridge.ethereumAddress"))}async handleSwitchItems(){this.setSoraToEvm(!this.isSoraToEvm),await this.getEvmNetworkFee()}handleMaxValue(){if(this.asset&&this.isRegisteredAsset){const t=this.isSoraToEvm?this.soraNetworkFee:this.evmNetworkFee,e=(0,p.MN)(this.asset,t,!this.isSoraToEvm);this.setAmount(e)}}async handleConfirmTransaction(){if(this.allowFeePopup&&!this.isXorSufficientForNextOperation){if(this.openWarningFeeDialog(),await this.waitOnNextTxFailureConfirmation(),!this.isWarningFeeDialogConfirmed)return;this.isWarningFeeDialogConfirmed=!1}await this.checkConnectionToExternalAccount((()=>{this.showConfirmTransactionDialog=!0}))}handleViewTransactionsHistory(){g.ZP.push({name:v.sn.BridgeTransactionsHistory})}handleChangeNetwork(){this.showSelectNetworkDialog=!0}openSelectAssetDialog(){this.showSelectTokenDialog=!0}async selectNetwork(t){this.showSelectNetworkDialog=!1,this.setEvmNetwork(t)}async selectAsset(t){t&&await this.withSelectAssetLoading((async()=>{await this.setAssetAddress(t.address),await this.getEvmNetworkFee()}))}async confirmTransaction(t){t&&await this.checkConnectionToExternalAccount((async()=>{const t=await this.generateHistoryItem(),{assetAddress:e,type:s,id:i}=t;if(s===n.Operation.EthBridgeOutgoing&&e){this.accountAssetsAddressTable[e]||await this.addAssetToAccountAssets(e)}this.setHistoryId(i),g.ZP.push({name:v.sn.BridgeTransaction})}))}};(0,o.__decorate)([h.SB.bridge.evmNetworkFeeFetching],b.prototype,"evmNetworkFeeFetching",void 0),(0,o.__decorate)([h.SB.web3.subNetworks],b.prototype,"subNetworks",void 0),(0,o.__decorate)([h.SB.bridge.amount],b.prototype,"amount",void 0),(0,o.__decorate)([h.SB.bridge.isSoraToEvm],b.prototype,"isSoraToEvm",void 0),(0,o.__decorate)([h.SB.assets.registeredAssetsFetching],b.prototype,"registeredAssetsFetching",void 0),(0,o.__decorate)([h.Yn.bridge.asset],b.prototype,"asset",void 0),(0,o.__decorate)([h.Yn.bridge.isRegisteredAsset],b.prototype,"isRegisteredAsset",void 0),(0,o.__decorate)([h.Yn.settings.nodeIsConnected],b.prototype,"nodeIsConnected",void 0),(0,o.__decorate)([h.QF.bridge.setSoraToEvm],b.prototype,"setSoraToEvm",void 0),(0,o.__decorate)([h.QF.bridge.setHistoryId],b.prototype,"setHistoryId",void 0),(0,o.__decorate)([h.QF.bridge.setAmount],b.prototype,"setAmount",void 0),(0,o.__decorate)([h.aD.bridge.setAssetAddress],b.prototype,"setAssetAddress",void 0),(0,o.__decorate)([h.aD.bridge.resetBridgeForm],b.prototype,"resetBridgeForm",void 0),(0,o.__decorate)([h.aD.bridge.resetBalanceSubscription],b.prototype,"resetBalanceSubscription",void 0),(0,o.__decorate)([h.aD.bridge.updateBalanceSubscription],b.prototype,"updateBalanceSubscription",void 0),(0,o.__decorate)([h.aD.bridge.getEvmNetworkFee],b.prototype,"getEvmNetworkFee",void 0),(0,o.__decorate)([h.aD.bridge.generateHistoryItem],b.prototype,"generateHistoryItem",void 0),(0,o.__decorate)([h.aD.wallet.account.addAsset],b.prototype,"addAssetToAccountAssets",void 0),(0,o.__decorate)([(0,a.RL)("nodeIsConnected")],b.prototype,"updateConnectionSubsriptions",null),b=(0,o.__decorate)([(0,a.wA)({components:{BridgeSelectAsset:(0,g.kF)(v.z8.BridgeSelectAsset),BridgeSelectNetwork:(0,g.kF)(v.z8.BridgeSelectNetwork),BridgeTransactionDetails:(0,g.kF)(v.z8.BridgeTransactionDetails),GenericPageHeader:(0,g.kF)(v.z8.GenericPageHeader),ConfirmBridgeTransactionDialog:(0,g.kF)(v.z8.ConfirmBridgeTransactionDialog),NetworkFeeWarningDialog:(0,g.kF)(v.z8.NetworkFeeWarningDialog),TokenSelectButton:(0,g.kF)(v.z8.TokenSelectButton),FormattedAmount:r.wx.FormattedAmount,FormattedAmountWithFiatValue:r.wx.FormattedAmountWithFiatValue,InfoLine:r.wx.InfoLine,TokenAddress:r.wx.TokenAddress}})],b);var f=b,k=(0,s(1001).Z)(f,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bridge s-flex"},[s("s-form",{staticClass:"bridge-form el-form--actions",attrs:{"show-message":!1}},[s("s-card",{directives:[{name:"loading",rawName:"v-loading",value:t.parentLoading,expression:"parentLoading"}],staticClass:"bridge-content",attrs:{"border-radius":"medium",shadow:"always",size:"big",primary:""}},[s("generic-page-header",{staticClass:"header--bridge",attrs:{title:t.t("bridge.title"),tooltip:t.t("bridge.info")}},[t.areNetworksConnected?s("s-button",{staticClass:"el-button--history",attrs:{type:"action",icon:"time-time-history-24",tooltip:t.t("bridgeHistory.showHistory"),"tooltip-placement":"bottom-end"},on:{click:t.handleViewTransactionsHistory}}):t._e()],1),s("s-float-input",{staticClass:"s-input--token-value",attrs:{value:t.amount,decimals:t.getDecimals(t.isSoraToEvm),delimiters:t.delimiters,max:t.MaxInputNumber,disabled:!t.areNetworksConnected||!t.isAssetSelected,"has-locale-string":"",size:"medium"},on:{input:t.setAmount},scopedSlots:t._u([{key:"bottom",fn:function(){return[s("div",{staticClass:"input-line input-line--footer"},[t.asset&&t.isSoraToEvm?s("formatted-amount",{attrs:{"is-fiat-value":"",value:t.getFiatAmountByString(t.amount,t.asset)}}):t._e(),t.isAssetSelected?s("token-address",t._b({staticClass:"input-value",attrs:{external:!t.isSoraToEvm}},"token-address",t.asset,!1)):t._e()],1),t.isNetworkAConnected?s("div",{staticClass:"bridge-item-footer"},[s("s-divider",{attrs:{type:"tertiary"}}),s("s-tooltip",{attrs:{content:t.getCopyTooltip(t.isSoraToEvm),"border-radius":"mini",placement:"bottom-end",tabindex:"-1"}},[s("span",{staticClass:"bridge-network-address",on:{click:function(e){return t.handleCopyAddress(t.accountAddressFrom,e)}}},[t._v(" "+t._s(t.formatAddress(t.accountAddressFrom,8))+" ")])]),s("span",[t._v(t._s(t.t("bridge.connected")))])],1):s("s-button",{staticClass:"el-button--connect s-typography-button--large",attrs:{type:"primary"},on:{click:function(e){t.isSoraToEvm?t.connectInternalWallet():t.connectExternalWallet()}}},[t._v(" "+t._s(t.t("bridge.connectWallet"))+" ")])]},proxy:!0}])},[s("div",{staticClass:"input-line",attrs:{slot:"top"},slot:"top"},[s("div",{staticClass:"input-title"},[s("span",{staticClass:"input-title--uppercase input-title--primary"},[t._v(t._s(t.t("transfers.from")))]),s("span",{staticClass:"input-title--network"},[t._v(t._s(t.getBridgeItemTitle(t.isSoraToEvm)))]),s("i",{class:"s-icon-"+(t.isSoraToEvm?"sora":t.getEvmIcon(t.evmNetwork))})]),t.isNetworkAConnected&&t.isAssetSelected?s("div",{staticClass:"input-value"},[s("span",{staticClass:"input-value--uppercase"},[t._v(t._s(t.t("bridge.balance")))]),s("formatted-amount-with-fiat-value",{attrs:{"value-can-be-hidden":"","with-left-shift":"","value-class":"input-value--primary",value:t.formatBalance(t.isSoraToEvm),"fiat-value":t.firstFieldFiatBalance}})],1):t._e()]),t.isNetworkAConnected?s("div",{staticClass:"s-flex el-buttons",attrs:{slot:"right"},slot:"right"},[t.isMaxAvailable?s("s-button",{staticClass:"el-button--max s-typography-button--small",attrs:{type:"primary",alternative:"",size:"mini","border-radius":"mini"},on:{click:t.handleMaxValue}},[t._v(" "+t._s(t.t("buttons.max"))+" ")]):t._e(),s("token-select-button",{staticClass:"el-button--select-token",attrs:{icon:"chevron-down-rounded-16",token:t.asset},on:{click:t.openSelectAssetDialog}})],1):t._e()]),s("s-button",{staticClass:"s-button--switch",attrs:{type:"action",icon:"arrows-swap-90-24"},on:{click:t.handleSwitchItems}}),s("s-float-input",{staticClass:"s-input--token-value",attrs:{value:t.amount,decimals:t.getDecimals(!t.isSoraToEvm),delimiters:t.delimiters,max:t.MaxInputNumber,"has-locale-string":"",size:"medium",disabled:""},scopedSlots:t._u([{key:"bottom",fn:function(){return[s("div",{staticClass:"input-line input-line--footer"},[t.asset&&!t.isSoraToEvm?s("formatted-amount",{attrs:{value:t.getFiatAmountByString(t.amount,t.asset),"is-fiat-value":""}}):t._e(),t.isAssetSelected?s("token-address",t._b({staticClass:"input-value",attrs:{external:t.isSoraToEvm}},"token-address",t.asset,!1)):t._e()],1),t.isNetworkBConnected?s("div",{staticClass:"bridge-item-footer"},[s("s-divider",{attrs:{type:"tertiary"}}),s("s-tooltip",{attrs:{content:t.getCopyTooltip(!t.isSoraToEvm),"border-radius":"mini",placement:"bottom-end",tabindex:"-1"}},[s("span",{staticClass:"bridge-network-address",on:{click:function(e){return t.handleCopyAddress(t.accountAddressTo,e)}}},[t._v(" "+t._s(t.formatAddress(t.accountAddressTo,8))+" ")])]),s("span",[t._v(t._s(t.t("bridge.connected")))])],1):s("s-button",{staticClass:"el-button--connect s-typography-button--large",attrs:{type:"primary"},on:{click:function(e){t.isSoraToEvm?t.connectExternalWallet():t.connectInternalWallet()}}},[t._v(" "+t._s(t.t("bridge.connectWallet"))+" ")])]},proxy:!0}])},[s("div",{staticClass:"input-line",attrs:{slot:"top"},slot:"top"},[s("div",{staticClass:"input-title",on:{click:t.handleChangeNetwork}},[s("span",{staticClass:"input-title--uppercase input-title--primary"},[t._v(t._s(t.t("transfers.to")))]),s("span",{staticClass:"input-title--network"},[t._v(t._s(t.getBridgeItemTitle(!t.isSoraToEvm)))]),s("i",{class:"s-icon-"+(t.isSoraToEvm?t.getEvmIcon(t.evmNetwork):"sora")})]),t.isNetworkAConnected&&t.isAssetSelected?s("div",{staticClass:"input-value"},[s("span",{staticClass:"input-value--uppercase"},[t._v(t._s(t.t("bridge.balance")))]),s("formatted-amount-with-fiat-value",{attrs:{"value-can-be-hidden":"","with-left-shift":"","value-class":"input-value--primary",value:t.formatBalance(!t.isSoraToEvm),"fiat-value":t.secondFieldFiatBalance}})],1):t._e()]),t.isNetworkAConnected&&t.isAssetSelected?s("div",{staticClass:"s-flex el-buttons",attrs:{slot:"right"},slot:"right"},[s("token-select-button",{staticClass:"el-button--select-token",attrs:{token:t.asset}})],1):t._e()]),s("s-button",{staticClass:"el-button--next s-typography-button--large",attrs:{type:"primary",disabled:t.isConfirmTxDisabled,loading:t.isConfirmTxLoading},on:{click:t.handleConfirmTransaction}},[t.isValidNetworkType?t.isAssetSelected?t.isRegisteredAsset?t.areNetworksConnected?t.isZeroAmount?[t._v(" "+t._s(t.t("buttons.enterAmount"))+" ")]:t.isInsufficientBalance?[t._v(" "+t._s(t.t("confirmBridgeTransactionDialog.insufficientBalance",{tokenSymbol:t.assetSymbol}))+" ")]:t.isInsufficientXorForFee?[t._v(" "+t._s(t.t("confirmBridgeTransactionDialog.insufficientBalance",{tokenSymbol:t.KnownSymbols.XOR}))+" ")]:t.isInsufficientEvmNativeTokenForFee?[t._v(" "+t._s(t.t("confirmBridgeTransactionDialog.insufficientBalance",{tokenSymbol:t.evmTokenSymbol}))+" ")]:[t._v(" "+t._s(t.t("bridge.next"))+" ")]:[t._v(" "+t._s(t.t("bridge.next"))+" ")]:[t._v(" "+t._s(t.t("bridge.notRegisteredAsset",{assetSymbol:t.assetSymbol}))+" ")]:[t._v(" "+t._s(t.t("buttons.chooseAToken"))+" ")]:[t._v(" "+t._s(t.t("bridge.changeNetwork"))+" ")]],2),t.areNetworksConnected&&!t.isZeroAmount&&t.isRegisteredAsset?s("bridge-transaction-details",{staticClass:"info-line-container",attrs:{"info-only":!1,"evm-token-symbol":t.evmTokenSymbol,"evm-network-fee":t.evmNetworkFee,"sora-network-fee":t.soraNetworkFee}}):t._e()],1),s("bridge-select-asset",{attrs:{visible:t.showSelectTokenDialog,asset:t.asset},on:{"update:visible":function(e){t.showSelectTokenDialog=e},select:t.selectAsset}}),s("confirm-bridge-transaction-dialog",{attrs:{visible:t.showConfirmTransactionDialog,"is-valid-network-type":t.isValidNetworkType,"is-sora-to-evm":t.isSoraToEvm,"is-insufficient-balance":t.isInsufficientBalance,asset:t.asset,amount:t.amount,"evm-token-symbol":t.evmTokenSymbol,"evm-network":t.evmNetwork,"evm-network-fee":t.evmNetworkFee,"sora-network-fee":t.soraNetworkFee},on:{"update:visible":function(e){t.showConfirmTransactionDialog=e},confirm:t.confirmTransaction}}),s("network-fee-warning-dialog",{attrs:{visible:t.showWarningFeeDialog,fee:t.formattedSoraNetworkFee},on:{"update:visible":function(e){t.showWarningFeeDialog=e},confirm:t.confirmNetworkFeeWariningDialog}})],1),t.areNetworksConnected?t._e():s("div",{staticClass:"bridge-footer"},[t._v(t._s(t.t("bridge.connectWallets")))])],1)}),[],!1,null,"15e40bfc",null).exports}}]);