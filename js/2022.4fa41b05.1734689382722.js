"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[2022,6543],{4853:function(e,t,s){s.r(t),s.d(t,{default:function(){return p}});var r=s(23166),i=s(97582),o=s(99278),d=s(86424),n=s(89445),l=s(89334),a=s(49053),c=s(50961),h=s(81732);let g=class extends((0,n.Wr)(l.Z,d.tA.LoadingMixin,d.tA.FormattedAmountMixin)){constructor(...e){super(...e),(0,r.Z)(this,"userLimitOrders",void 0),(0,r.Z)(this,"currentOrderBook",void 0),(0,r.Z)(this,"subscribeOnLimitOrders",void 0),(0,r.Z)(this,"resetLimitOrdersSubscription",void 0),(0,r.Z)(this,"ordersToBeCancelled",void 0),(0,r.Z)(this,"setOrdersToBeCancelled",void 0),(0,r.Z)(this,"orderTable",void 0),(0,r.Z)(this,"currentPage",1),(0,r.Z)(this,"tableItems",[]),(0,r.Z)(this,"selectedPageItemIds",[]),(0,r.Z)(this,"needToUpdateSelection",!1),(0,r.Z)(this,"syncTableItemsRefreshing",!1)}get ordersToBeCancelledIds(){return this.ordersToBeCancelled.map((({id:e})=>e))}get loadingState(){return this.parentLoading||this.loading}get isSelectionAllowed(){return!!this.currentOrderBook&&this.currentOrderBook.status!==o.OrderBookStatus.Stop}get sortedUserLimitOrders(){return[...this.userLimitOrders].sort(((e,t)=>t.time-e.time))}async updatePagedOrdersSubscription(e,t){if(e?.length&&e.length!==t?.length){if(this.syncTableItemsRefreshing=!0,await(0,c.AE)((()=>!this.syncTableItemsRefreshing)),this.ordersToBeCancelledIds.length){const e=this.tableItems.filter((({id:e})=>this.ordersToBeCancelledIds.includes(e)));this.setOrdersToBeCancelled(e)}this.handlePagination(this.currentPage)}}async handlePagination(e,t){await this.withLoading((async()=>{const s=t??this.tableItems;this.currentPage=e,this.resetLimitOrdersSubscription(),s.length&&await this.subscribeOnLimitOrders(s.map((({id:e})=>e)))}))}restoreSelectedData(){const e=this.tableItems.filter((({id:e})=>this.ordersToBeCancelledIds.includes(e)));e.forEach((e=>{this.orderTable?.tableComponent?.toggleRowSelection?.(e,!0)})),this.selectedPageItemIds=e.map((({id:e})=>e))}handleSelect(e){this.needToUpdateSelection=!0}handleSelectRow(e){this.isSelectionAllowed&&(this.needToUpdateSelection=!0,this.orderTable?.tableComponent?.toggleRowSelection?.(e))}handleSelectionChange(e){if(!this.isSelectionAllowed||!this.needToUpdateSelection)return;const t=this.selectedPageItemIds.length-e.length;if(1===t){const t=e.map((({id:e})=>e)),s=this.selectedPageItemIds.find((e=>!t.includes(e)));s&&this.setOrdersToBeCancelled(this.ordersToBeCancelled.filter((({id:e})=>e!==s)))}else if(-1===t){const t=e.find((({id:e})=>!this.selectedPageItemIds.includes(e)));t&&this.setOrdersToBeCancelled([...this.ordersToBeCancelled,t])}this.selectedPageItemIds=e.map((({id:e})=>e)),this.needToUpdateSelection=!1}syncTableItems(e){this.tableItems=e,this.syncTableItemsRefreshing=!1,this.restoreSelectedData()}beforeDestroy(){this.isSelectionAllowed&&this.setOrdersToBeCancelled([]),this.resetLimitOrdersSubscription()}};(0,i.gn)([a.SB.orderBook.userLimitOrders],g.prototype,"userLimitOrders",void 0),(0,i.gn)([a.Yn.orderBook.currentOrderBook],g.prototype,"currentOrderBook",void 0),(0,i.gn)([a.aD.orderBook.subscribeOnLimitOrders],g.prototype,"subscribeOnLimitOrders",void 0),(0,i.gn)([a.QF.orderBook.resetPagedUserLimitOrdersSubscription],g.prototype,"resetLimitOrdersSubscription",void 0),(0,i.gn)([a.SB.orderBook.ordersToBeCancelled],g.prototype,"ordersToBeCancelled",void 0),(0,i.gn)([a.QF.orderBook.setOrdersToBeCancelled],g.prototype,"setOrdersToBeCancelled",void 0),(0,i.gn)([(0,n.Rl)("orderTable")],g.prototype,"orderTable",void 0),(0,i.gn)([(0,n.RL)("sortedUserLimitOrders",{deep:!0,immediate:!0})],g.prototype,"updatePagedOrdersSubscription",null),g=(0,i.gn)([(0,n.wA)({components:{OrderTable:h.default,HistoryPagination:d.wx.HistoryPagination}})],g);var u=g,p=(0,s(1001).Z)(u,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("order-table",{ref:"orderTable",attrs:{"is-open-orders":"",orders:e.sortedUserLimitOrders,selectable:e.isSelectionAllowed,"parent-loading":e.loadingState},on:{"cell-click":e.handleSelectRow,"selection-change":e.handleSelectionChange,select:e.handleSelect,"page-updated":e.handlePagination,sync:e.syncTableItems}})}),[],!1,null,null,null).exports}}]);