"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[5373],{35373:function(e,t,l){l.r(t),l.d(t,{default:function(){return m}});var a=l(23166),r=l(97582),o=l(37981),i=l(69826),s=l(86424),n=l(89445),u=l(68282),c=l(94503),h=l(35681),d=l(69781),b=l(49053),v=l(50961);let g=class extends((0,n.Wr)(s.tA.TransactionMixin,s.tA.DialogMixin,s.tA.FormattedAmountMixin)){constructor(...e){super(...e),(0,a.Z)(this,"xorSymbol",i.XOR.symbol),(0,a.Z)(this,"getLtvStatus",h.D),(0,a.Z)(this,"collateralInput",void 0),(0,a.Z)(this,"percentFormat",void 0),(0,a.Z)(this,"networkFees",void 0),(0,a.Z)(this,"slippageTolerance",void 0),(0,a.Z)(this,"collaterals",void 0),(0,a.Z)(this,"getTax",void 0),(0,a.Z)(this,"averageCollateralPrice",void 0),(0,a.Z)(this,"accountXor",void 0),(0,a.Z)(this,"isLoggedIn",void 0),(0,a.Z)(this,"debtToken",void 0),(0,a.Z)(this,"collateralToken",void 0),(0,a.Z)(this,"setCollateralAddress",void 0),(0,a.Z)(this,"setDebtAddress",void 0),(0,a.Z)(this,"collateralValue",""),(0,a.Z)(this,"borrowValue",""),(0,a.Z)(this,"showSelectTokenDialog",!1),(0,a.Z)(this,"isCollateralSelected",!0)}async handleDialogVisibility(e){await this.$nextTick(),this.collateralValue="",this.borrowValue="",e||this.setCollateralAddress(),this.showSelectTokenDialog=!1,this.collateralInput?.focus()}get collateralId(){return this.collateralToken&&this.debtToken?s.hi.kensetsu.serializeKey(this.collateralToken.address,this.debtToken.address):""}get collateral(){return this.collateralId?this.collaterals[this.collateralId]:null}get maxLtv(){return this.collateral?this.collateral.riskParams.liquidationRatioReversed:u.Tv}get xorBalance(){return this.getFPNumberFromCodec(this.accountXor?.balance?.transferable??u.m8)}get networkFee(){return this.networkFees[o.Operation.CreateVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isLtvGtHundred(){return this.ltv?.gt(this.Hundred)??!1}get minDeposit(){return this.collateral?.riskParams.minDeposit??this.Zero}get isCollateralZero(){return(0,v.yA)(this.collateralValue)}get isBorrowZero(){return(0,v.yA)(this.borrowValue)}get collateralValueFp(){return this.isCollateralZero?this.Zero:this.getFPNumber(this.collateralValue,this.collateralToken?.decimals)}get borrowValueFp(){return this.isBorrowZero?this.Zero:this.getFPNumber(this.borrowValue,this.debtToken?.decimals)}get isInsufficientBalance(){return!this.collateralToken||(0,v.Vl)(this.collateralToken,this.collateralValue,this.networkFee)}get isLessThanMinDeposit(){return!this.collateralValue||this.collateralValueFp.lt(this.minDeposit)}get isIncorrectCollateral(){return!(!this.collateralToken||!this.debtToken)&&!this.collateral}get disabled(){return this.loading||this.isIncorrectCollateral||this.isInsufficientXorForFee||this.isLessThanMinDeposit||this.isInsufficientBalance||!this.ltv||this.isBorrowZero||this.ltv.gt(this.Hundred)}get collateralAssetBalance(){return(0,v.rh)(this.collateralToken)}get availableCollateralBalanceFp(){let e=this.getFPNumberFromCodec(this.collateralAssetBalance);return this.collateralToken?.address===i.XOR.address&&(e=e.sub(this.fpNetworkFee),e.isLtZero()&&(e=this.Zero)),e}get isMaxCollateralAvailable(){return!!this.shouldBalanceBeHidden||!this.availableCollateralBalanceFp.isLteZero()&&(!!this.isCollateralZero||!this.collateralValueFp.isEqualTo(this.availableCollateralBalanceFp))}get collateralValuePercent(){if(!this.collateralValue)return 0;const e=this.collateralValueFp.div(this.availableCollateralBalanceFp).mul(u.Tv).toNumber(0);return e>u.Tv?u.Tv:e}get selectTokenFilter(){const e=Object.values(this.collaterals).map((e=>this.isCollateralSelected?e.lockedAssetId:e.debtAssetId));return t=>e.includes(t?.address)}get isMaxBorrowAvailable(){return!this.isCollateralZero&&!this.availableCollateralBalanceFp.lt(this.minDeposit)&&(!(!this.shouldBalanceBeHidden&&!this.isBorrowZero)||!(!this.maxBorrowPerCollateralValueOrAvailable.isFinity()||this.maxBorrowPerCollateralValueOrAvailable.isLteZero())&&!this.borrowValueFp.isEqualTo(this.maxBorrowPerCollateralValueOrAvailable))}get isBorrowSliderAvailable(){return this.availableCollateralBalanceFp.gte(this.minDeposit)}get debtSymbol(){return this.debtToken?.symbol??""}get collateralSymbol(){return this.collateralToken?.symbol??""}get maxBorrowPerMaxCollateralNumber(){return this.maxBorrowPerMaxCollateralFp.toNumber()}get borrowTax(){return this.debtToken?this.getTax(this.debtToken.address):0}get kusdAvailable(){const e=this.collateral?.riskParams.hardCap.sub(this.collateral.debtSupply)??this.Zero,t=e.sub(e.mul(this.borrowTax??0));return t.isLtZero()?this.Zero:t}get maxBorrowPerMaxCollateralFp(){if(!this.averageCollateralPrice||!this.availableCollateralBalanceFp.isFinity()||this.availableCollateralBalanceFp.isZero())return this.Zero;const e=this.averageCollateralPrice.mul(this.availableCollateralBalanceFp).mul(this.collateral?.riskParams.liquidationRatioReversed??0).div(u.Tv),t=e.sub(e.mul(this.borrowTax));return t.gt(this.kusdAvailable)?this.kusdAvailable:t}get formattedMinDeposit(){return this.minDeposit.toLocaleString()??u.m8}get minDepositFiat(){return this.collateralToken?this.getFiatAmountByFPNumber(this.minDeposit,this.collateralToken):null}get borrowTaxPercent(){return this.percentFormat?.format?.(this.borrowTax)??this.borrowTax*u.Tv+"%"}get formattedBorrowTax(){return this.borrowValueFp.mul(this.borrowTax??0).toLocaleString()}get maxBorrowCodec(){return this.availableCollateralBalanceFp.lt(this.minDeposit)?u.m8:this.maxBorrowPerMaxCollateralFp.toCodecString()}get maxBorrowPerCollateralValue(){if(!this.averageCollateralPrice||this.isCollateralZero)return this.Zero;const e=this.averageCollateralPrice.mul(this.collateralValue).mul(this.collateral?.riskParams.liquidationRatioReversed??0).div(u.Tv);return e.sub(e.mul(this.borrowTax))}get maxBorrowPerCollateralValueOrAvailable(){return this.maxBorrowPerCollateralValue.gt(this.kusdAvailable)?this.kusdAvailable:this.maxBorrowPerCollateralValue}get ltvCoeff(){return this.isCollateralZero?null:this.isBorrowZero?this.Zero:this.borrowValueFp.div(this.maxBorrowPerCollateralValue)}get ltv(){return this.ltvCoeff?.isFinity()?this.ltvCoeff.mul(u.Tv):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):u.m8}get ltvText(){return c.ho[(0,h.D)(this.ltvNumber)]}get formattedStabilityFee(){return(this.collateral?.riskParams.stabilityFeeAnnual??this.Zero).toLocaleString()}get borrowValuePercent(){if(!this.borrowValue)return 0;const e=this.borrowValueFp.div(this.maxBorrowPerCollateralValueOrAvailable).mul(u.Tv).toNumber(0);return e>u.Tv?u.Tv:e}handleCollateralPercentChange(e){this.collateralValue=this.availableCollateralBalanceFp.mul(e/u.Tv).toString()}handleMaxCollateralValue(){this.collateralValue=this.availableCollateralBalanceFp.toString()}handleMaxBorrowValue(){this.borrowValue=this.maxBorrowPerCollateralValueOrAvailable.toString()}handleBorrowPercentChange(e){this.borrowValue=this.maxBorrowPerCollateralValueOrAvailable.mul(e/u.Tv).toString()}openSelectTokenDialog(e=!0){this.isCollateralSelected=e,this.showSelectTokenDialog=!0}handleSelectToken(e){this.isCollateralSelected?this.setCollateralAddress(e?.address):this.setDebtAddress(e?.address),this.collateralValue="",this.borrowValue=""}get errorMessage(){let e="";return this.isInsufficientXorForFee?e=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isIncorrectCollateral?e=this.t("kensetsu.error.incorrectCollateral"):this.ltv?this.isBorrowZero?e=this.t("kensetsu.error.enterBorrow"):this.isLessThanMinDeposit?e=this.t("kensetsu.error.insufficientCollateral"):this.isInsufficientBalance?e=this.t("insufficientBalanceText",{tokenSymbol:this.collateralSymbol}):this.isLtvGtHundred&&(e=this.t("kensetsu.error.insufficientCollateral")):e=this.t("kensetsu.error.enterCollateral"),e}async handleCreate(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{const e=this.collateralToken,t=this.debtToken;if(!e||!t)return;await this.withNotifications((async()=>{await s.hi.kensetsu.createVault(e,t,this.collateralValue,this.borrowValue,this.slippageTolerance)}))}catch(e){console.error(e)}this.isVisible=!1}};(0,r.gn)([(0,n.Rl)("collateralInput")],g.prototype,"collateralInput",void 0),(0,r.gn)([b.SB.settings.percentFormat],g.prototype,"percentFormat",void 0),(0,r.gn)([b.SB.wallet.settings.networkFees],g.prototype,"networkFees",void 0),(0,r.gn)([b.SB.settings.slippageTolerance],g.prototype,"slippageTolerance",void 0),(0,r.gn)([b.SB.vault.collaterals],g.prototype,"collaterals",void 0),(0,r.gn)([b.Yn.vault.getBorrowTax],g.prototype,"getTax",void 0),(0,r.gn)([b.Yn.vault.averageCollateralPrice],g.prototype,"averageCollateralPrice",void 0),(0,r.gn)([b.Yn.assets.xor],g.prototype,"accountXor",void 0),(0,r.gn)([b.Yn.wallet.account.isLoggedIn],g.prototype,"isLoggedIn",void 0),(0,r.gn)([b.Yn.vault.debtToken],g.prototype,"debtToken",void 0),(0,r.gn)([b.Yn.vault.collateralToken],g.prototype,"collateralToken",void 0),(0,r.gn)([b.aD.vault.setCollateralTokenAddress],g.prototype,"setCollateralAddress",void 0),(0,r.gn)([b.aD.vault.setDebtTokenAddress],g.prototype,"setDebtAddress",void 0),(0,r.gn)([(0,n.RL)("visible")],g.prototype,"handleDialogVisibility",null),g=(0,r.gn)([(0,n.wA)({components:{DialogBase:s.wx.DialogBase,InfoLine:s.wx.InfoLine,TokenInput:(0,d.kF)(u.z8.TokenInput),SelectToken:(0,d.kF)(u.z8.SelectToken),ValueStatus:(0,d.kF)(u.z8.ValueStatusWrapper),SlippageTolerance:(0,d.kF)(u.z8.SlippageTolerance)}})],g);var p=g,m=(0,l(1001).Z)(p,(function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",[t("dialog-base",{attrs:{title:e.t("kensetsu.createVault"),visible:e.isVisible,tooltip:e.t("kensetsu.createVaultDescription")},on:{"update:visible":function(t){e.isVisible=t}}},[t("div",{staticClass:"vault-create"},[t("token-input",{ref:"collateralInput",staticClass:"vault-create__collateral-input vault-create__token-input",attrs:{"with-slider":"","is-fiat-editable":"","is-select-available":"",title:e.t("kensetsu.depositCollateral"),"is-max-available":e.isMaxCollateralAvailable,token:e.collateralToken,balance:e.collateralAssetBalance,"slider-value":e.collateralValuePercent,disabled:e.loading},on:{max:e.handleMaxCollateralValue,slide:e.handleCollateralPercentChange,select:function(t){return e.openSelectTokenDialog(!0)}},model:{value:e.collateralValue,callback:function(t){e.collateralValue=t},expression:"collateralValue"}}),t("token-input",{ref:"debtInput",staticClass:"vault-create__debt-input vault-create__token-input",attrs:{"is-fiat-editable":"","is-select-available":"","with-slider":e.isBorrowSliderAvailable,title:e.t("kensetsu.borrowDebt"),"balance-text":e.t("kensetsu.available"),balance:e.maxBorrowCodec,"is-max-available":e.isMaxBorrowAvailable,token:e.debtToken,"slider-value":e.borrowValuePercent,disabled:e.loading,max:e.maxBorrowPerMaxCollateralNumber},on:{max:e.handleMaxBorrowValue,slide:e.handleBorrowPercentChange,select:function(t){return e.openSelectTokenDialog(!1)}},model:{value:e.borrowValue,callback:function(t){e.borrowValue=t},expression:"borrowValue"}}),t("slippage-tolerance",{staticClass:"slippage-tolerance-settings vault-create__slippage"}),t("info-line",{attrs:{label:e.t("kensetsu.ltv"),"label-tooltip":e.t("kensetsu.ltvDescription"),value:e.formattedLtv,"asset-symbol":"%","is-formatted":""}},[e.ltv?t("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:e.ltvNumber,getStatus:e.getLtvStatus}},[e._v(" "+e._s(e.ltvText)+" ")]):e._e()],1),t("s-button",{staticClass:"s-typography-button--large action-button vault-create__button",attrs:{type:"primary",disabled:e.disabled},on:{click:e.handleCreate}},[e.disabled?[e._v(e._s(e.errorMessage))]:[e._v(e._s(e.t("kensetsu.createVaultAction")))]],2),t("info-line",{attrs:{label:e.t("kensetsu.minDepositCollateral"),"label-tooltip":e.t("kensetsu.minDepositCollateralDescription"),value:e.formattedMinDeposit,"asset-symbol":e.collateralSymbol,"fiat-value":e.minDepositFiat,"is-formatted":""}}),t("info-line",{attrs:{label:e.t("kensetsu.interest"),"label-tooltip":e.t("kensetsu.interestDescription"),value:e.formattedStabilityFee,"asset-symbol":"%","is-formatted":""}}),t("info-line",{attrs:{label:e.t("kensetsu.borrowTax"),"label-tooltip":e.t("kensetsu.borrowTaxDescription",{value:e.borrowTaxPercent}),value:e.formattedBorrowTax,"asset-symbol":e.debtSymbol,"is-formatted":""}}),t("info-line",{attrs:{label:e.t("networkFeeText"),"label-tooltip":e.t("networkFeeTooltipText"),value:e.networkFeeFormatted,"asset-symbol":e.xorSymbol,"fiat-value":e.getFiatAmountByCodecString(e.networkFee),"is-formatted":""}})],1)]),t("select-token",{attrs:{"disabled-custom":"",visible:e.showSelectTokenDialog,connected:e.isLoggedIn,filter:e.selectTokenFilter,asset:e.collateralToken},on:{"update:visible":function(t){e.showSelectTokenDialog=t},select:e.handleSelectToken}})],1)}),[],!1,null,"983f33a0",null).exports}}]);