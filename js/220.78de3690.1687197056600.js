"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[220],{40220:function(t,i,o){o.r(i),o.d(i,{default:function(){return _}});var e=o(60760),a=o(70655),s=o(53545),n=o(8755),l=o(6187),r=o(2054),d=o(85530),p=o(80710),g=o(16546),c=o(74614),h=o(28462),y=o(25108);let u=class extends((0,s.Wr)(r.Z)){constructor(...t){super(...t),(0,e.Z)(this,"widgetUrl",""),(0,e.Z)(this,"transactionsPolling",void 0),(0,e.Z)(this,"account",void 0),(0,e.Z)(this,"isLoggedIn",void 0),(0,e.Z)(this,"libraryTheme",void 0),(0,e.Z)(this,"transactions",void 0),(0,e.Z)(this,"pollingTimestamp",void 0),(0,e.Z)(this,"dialogVisibility",void 0),(0,e.Z)(this,"setDialogVisibility",void 0),(0,e.Z)(this,"createTransactionsPolling",void 0)}handleLoggedInStateChange(t){t||this.stopPollingMoonpay()}handleVisibleStateChange(t){t&&!this.pollingTimestamp&&this.startPollingMoonpay()}handleLanguageChange(){this.pollingTimestamp||this.updateWidgetUrl()}async handleLastTransaction(t,i){!t||i&&i.id===t.id||await this.prepareBridgeForTransfer(t)}get lastCompletedTransaction(){if(0!==this.pollingTimestamp)return this.transactions.find((t=>Date.parse(t.createdAt)>=this.pollingTimestamp&&"completed"===t.status))}get visibility(){return this.dialogVisibility}set visibility(t){this.setDialogVisibility(t)}async created(){this.withApi((()=>{this.initMoonpayApi(),this.updateWidgetUrl()}))}beforeDestroy(){this.stopPollingMoonpay()}createMoonpayWidgetUrl(){return this.moonpayApi.createWidgetUrl({colorCode:(0,d.y_)("--s-color-theme-accent"),externalTransactionId:this.account.address,language:this.language})}updateWidgetUrl(){this.widgetUrl="";const t=this.createMoonpayWidgetUrl();setTimeout((()=>{this.widgetUrl=t}))}async startPollingMoonpay(){y.info("Moonpay: start polling to get user transactions"),this.transactionsPolling=await this.createTransactionsPolling()}stopPollingMoonpay(){y.info("Moonpay: stop polling"),"function"==typeof this.transactionsPolling&&this.transactionsPolling()}async prepareBridgeForTransfer(t){this.setDialogVisibility(!1),this.stopPollingMoonpay(),this.updateWidgetUrl(),await this.showNotification(h.u.Success),await this.prepareMoonpayTxForBridgeTransfer(t,!0)}};(0,a.__decorate)([c.Yn.wallet.account.account],u.prototype,"account",void 0),(0,a.__decorate)([c.Yn.wallet.account.isLoggedIn],u.prototype,"isLoggedIn",void 0),(0,a.__decorate)([c.Yn.libraryTheme],u.prototype,"libraryTheme",void 0),(0,a.__decorate)([c.SB.moonpay.transactions],u.prototype,"transactions",void 0),(0,a.__decorate)([c.SB.moonpay.pollingTimestamp],u.prototype,"pollingTimestamp",void 0),(0,a.__decorate)([c.SB.moonpay.dialogVisibility],u.prototype,"dialogVisibility",void 0),(0,a.__decorate)([c.QF.moonpay.setDialogVisibility],u.prototype,"setDialogVisibility",void 0),(0,a.__decorate)([c.aD.moonpay.createTransactionsPolling],u.prototype,"createTransactionsPolling",void 0),(0,a.__decorate)([(0,s.RL)("isLoggedIn",{immediate:!0})],u.prototype,"handleLoggedInStateChange",null),(0,a.__decorate)([(0,s.RL)("visibility",{immediate:!0})],u.prototype,"handleVisibleStateChange",null),(0,a.__decorate)([(0,s.RL)("language"),(0,s.RL)("libraryTheme")],u.prototype,"handleLanguageChange",null),(0,a.__decorate)([(0,s.RL)("lastCompletedTransaction")],u.prototype,"handleLastTransaction",null),u=(0,a.__decorate)([(0,s.wA)({components:{DialogBase:n.wx.DialogBase,MoonpayLogo:l.default,Widget:(0,p.kF)(g.z8.Widget)}})],u);var m=u,_=(0,o(1001).Z)(m,(function(){var t=this,i=t.$createElement,o=t._self._c||i;return o("dialog-base",{staticClass:"moonpay-dialog",attrs:{visible:t.visibility},on:{"update:visible":function(i){t.visibility=i}},scopedSlots:t._u([{key:"title",fn:function(){return[o("moonpay-logo",{attrs:{theme:t.libraryTheme}})]},proxy:!0}])},[o("widget",{attrs:{src:t.widgetUrl}})],1)}),[],!1,null,null,null).exports}}]);