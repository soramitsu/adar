"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[7771],{77771:function(t,e,r){r.r(e),r.d(e,{default:function(){return m}});var o=r(23166),i=r(97582),a=r(37981),s=r(69826),l=r(86424),n=r(89445),u=r(68282),b=r(94503),h=r(87550),v=r(35681),d=r(69781),p=r(49053),c=r(50961);let g=class extends((0,n.Wr)(l.tA.TransactionMixin,l.tA.DialogMixin,l.tA.FormattedAmountMixin)){constructor(...t){super(...t),(0,o.Z)(this,"xorSymbol",s.XOR.symbol),(0,o.Z)(this,"getLtvStatus",v.D),(0,o.Z)(this,"debtInput",void 0),(0,o.Z)(this,"vault",void 0),(0,o.Z)(this,"debtAsset",void 0),(0,o.Z)(this,"collateral",void 0),(0,o.Z)(this,"prevLtv",void 0),(0,o.Z)(this,"available",void 0),(0,o.Z)(this,"maxSafeDebt",void 0),(0,o.Z)(this,"maxLtv",void 0),(0,o.Z)(this,"borrowTax",void 0),(0,o.Z)(this,"percentFormat",void 0),(0,o.Z)(this,"networkFees",void 0),(0,o.Z)(this,"slippageTolerance",void 0),(0,o.Z)(this,"accountXor",void 0),(0,o.Z)(this,"borrowValue","")}async handleDialogVisibility(t){await this.$nextTick(),this.borrowValue="",this.debtInput?.focus()}get xorBalance(){return this.getFPNumberFromCodec(this.accountXor?.balance?.transferable??u.m8)}get title(){return this.t("kensetsu.borrowMore")}get networkFee(){return this.networkFees[a.Operation.CreateVault]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isBorrowZero(){return(0,c.yA)(this.borrowValue)}get borrowFp(){return this.isBorrowZero?this.Zero:this.getFPNumber(this.borrowValue,this.debtAsset?.decimals)}get debtAvailable(){return this.collateral?.riskParams.hardCap.sub(this.collateral.debtSupply)??this.Zero}get availableOrTotal(){return this.available.gt(this.debtAvailable)?this.debtAvailable:this.available}get isBorrowMoreThanAvailable(){return this.borrowFp.gt(this.availableOrTotal)}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isBorrowZero||this.isBorrowMoreThanAvailable}get availableCodec(){return this.availableOrTotal.dp(a.FPNumber.DEFAULT_PRECISION).codec}get isMaxBorrowAvailable(){return!(!this.shouldBalanceBeHidden&&!this.isBorrowZero)||!(!this.availableOrTotal.isFinity()||this.availableOrTotal.isLteZero())&&!this.borrowFp.isEqualTo(this.availableOrTotal)}get debtSymbol(){return this.debtAsset?.symbol??""}get formattedPrevBorrow(){return this.vault?.debt.toLocaleString()??u.m8}get nextBorrow(){const t=this.vault?.debt;return this.isBorrowZero?t:t?.add(this.borrowValue)}get formattedNextBorrow(){return this.nextBorrow?.toLocaleString()??u.m8}get formattedPrevLtv(){return this.prevLtv?.toLocaleString(2)??u.m8}get ltvCoeff(){return this.nextBorrow?this.nextBorrow.div(this.maxSafeDebt):null}get ltv(){return this.ltvCoeff?.isFinity()?this.ltvCoeff.mul(u.Tv):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):u.m8}get ltvText(){return b.ho[(0,v.D)(this.ltvNumber)]}get borrowTaxPercent(){return this.percentFormat?.format?.(this.borrowTax)??this.borrowTax*u.Tv+"%"}get formattedBorrowTax(){return this.borrowFp?.mul(this.borrowTax??0).toLocaleString()??u.m8}get borrowValuePercent(){if(!this.borrowValue)return 0;const t=this.borrowFp.div(this.availableOrTotal).mul(u.Tv).toNumber(0);return t>u.Tv?u.Tv:t}handleMaxBorrowValue(){this.borrowValue=this.availableOrTotal.toString()}handleBorrowPercentChange(t){this.borrowValue=this.availableOrTotal.mul(t/u.Tv).toString()}get errorMessage(){let t="";return this.isInsufficientXorForFee?t=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isBorrowZero?t=this.t("kensetsu.error.enterBorrow"):this.isBorrowMoreThanAvailable&&(t=this.t("kensetsu.error.borrowMoreThanAvailable")),t}async handleBorrowMore(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications((async()=>{if(!this.vault||!this.debtAsset)throw new Error("[api.kensetsu.borrow]: vault is null");await l.hi.kensetsu.borrow(this.vault,this.borrowValue,this.debtAsset,this.slippageTolerance)})),this.$emit("confirm")}catch(t){console.error(t)}this.isVisible=!1}};(0,i.gn)([(0,n.Rl)("debtInput")],g.prototype,"debtInput",void 0),(0,i.gn)([(0,n.fI)({type:Object,default:u.u8})],g.prototype,"vault",void 0),(0,i.gn)([(0,n.fI)({type:Object,default:u.u8})],g.prototype,"debtAsset",void 0),(0,i.gn)([(0,n.fI)({type:Object,default:u.u8})],g.prototype,"collateral",void 0),(0,i.gn)([(0,n.fI)({type:Object,default:()=>a.FPNumber.ZERO})],g.prototype,"prevLtv",void 0),(0,i.gn)([(0,n.fI)({type:Object,default:()=>a.FPNumber.ZERO})],g.prototype,"available",void 0),(0,i.gn)([(0,n.fI)({type:Object,default:()=>a.FPNumber.ZERO})],g.prototype,"maxSafeDebt",void 0),(0,i.gn)([(0,n.fI)({type:Number,default:u.Tv})],g.prototype,"maxLtv",void 0),(0,i.gn)([(0,n.fI)({type:Number,default:0})],g.prototype,"borrowTax",void 0),(0,i.gn)([p.SB.settings.percentFormat],g.prototype,"percentFormat",void 0),(0,i.gn)([p.SB.wallet.settings.networkFees],g.prototype,"networkFees",void 0),(0,i.gn)([p.SB.settings.slippageTolerance],g.prototype,"slippageTolerance",void 0),(0,i.gn)([p.Yn.assets.xor],g.prototype,"accountXor",void 0),(0,i.gn)([(0,n.RL)("visible")],g.prototype,"handleDialogVisibility",null),g=(0,i.gn)([(0,n.wA)({components:{DialogBase:l.wx.DialogBase,InfoLine:l.wx.InfoLine,TokenInput:(0,d.kF)(u.z8.TokenInput),ValueStatus:(0,d.kF)(u.z8.ValueStatusWrapper),PrevNextInfoLine:(0,h.rP)(b.JB.PrevNextInfoLine),SlippageTolerance:(0,d.kF)(u.z8.SlippageTolerance)}})],g);var w=g,m=(0,r(1001).Z)(w,(function(){var t=this,e=t._self._c;t._self._setupProxy;return e("dialog-base",{attrs:{title:t.title,visible:t.isVisible,tooltip:t.t("kensetsu.borrowMoreDescription")},on:{"update:visible":function(e){t.isVisible=e}}},[e("div",{staticClass:"borrow-more"},[e("token-input",{ref:"debtInput",staticClass:"borrow-more__debt-input borrow-more__token-input",attrs:{"with-slider":"","is-fiat-editable":"",title:t.title,"balance-text":t.t("kensetsu.available"),"is-max-available":t.isMaxBorrowAvailable,token:t.debtAsset,balance:t.availableCodec,"slider-value":t.borrowValuePercent,disabled:t.loading},on:{max:t.handleMaxBorrowValue,slide:t.handleBorrowPercentChange},model:{value:t.borrowValue,callback:function(e){t.borrowValue=e},expression:"borrowValue"}}),e("slippage-tolerance",{staticClass:"slippage-tolerance-settings borrow-more__slippage"}),e("prev-next-info-line",{attrs:{label:t.t("kensetsu.outstandingDebt"),tooltip:t.t("kensetsu.outstandingDebtDescription"),symbol:t.debtSymbol,prev:t.formattedPrevBorrow,next:t.formattedNextBorrow}}),e("prev-next-info-line",{attrs:{symbol:"%",label:t.t("kensetsu.ltv"),tooltip:t.t("kensetsu.ltvDescription"),prev:t.formattedPrevLtv,next:t.formattedLtv}},[t.ltv?e("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:t.ltvNumber,getStatus:t.getLtvStatus}},[t._v(" "+t._s(t.ltvText)+" ")]):t._e()],1),e("s-button",{staticClass:"s-typography-button--large action-button borrow-more__button",attrs:{type:"primary",disabled:t.disabled},on:{click:t.handleBorrowMore}},[t.disabled?[t._v(t._s(t.errorMessage))]:[t._v(t._s(t.title))]],2),e("info-line",{attrs:{label:t.t("kensetsu.borrowTax"),"label-tooltip":t.t("kensetsu.borrowTaxDescription",{value:t.borrowTaxPercent}),value:t.formattedBorrowTax,"asset-symbol":t.debtSymbol,"is-formatted":""}}),e("info-line",{attrs:{"is-formatted":"",label:t.t("networkFeeText"),"label-tooltip":t.t("networkFeeTooltipText"),value:t.networkFeeFormatted,"asset-symbol":t.xorSymbol,"fiat-value":t.getFiatAmountByCodecString(t.networkFee)}})],1)])}),[],!1,null,"a5c4437c",null).exports}}]);