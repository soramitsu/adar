"use strict";(self.webpackChunkadar=self.webpackChunkadar||[]).push([[3097],{33097:function(t,e,l){l.r(e),l.d(e,{default:function(){return g}});var a=l(23166),r=l(97582),i=l(37981),o=l(69826),s=l(86424),n=l(89445),u=l(68282),d=l(94503),c=l(87550),h=l(35681),v=l(69781),b=l(49053),p=l(50961);let f=class extends((0,n.Wr)(s.tA.TransactionMixin,s.tA.DialogMixin,s.tA.FormattedAmountMixin)){constructor(...t){super(...t),(0,a.Z)(this,"xorSymbol",o.XOR.symbol),(0,a.Z)(this,"getLtvStatus",h.D),(0,a.Z)(this,"collateralInput",void 0),(0,a.Z)(this,"collateral",void 0),(0,a.Z)(this,"vault",void 0),(0,a.Z)(this,"lockedAsset",void 0),(0,a.Z)(this,"debtAsset",void 0),(0,a.Z)(this,"prevLtv",void 0),(0,a.Z)(this,"prevAvailable",void 0),(0,a.Z)(this,"averageCollateralPrice",void 0),(0,a.Z)(this,"maxLtv",void 0),(0,a.Z)(this,"borrowTax",void 0),(0,a.Z)(this,"networkFees",void 0),(0,a.Z)(this,"accountXor",void 0),(0,a.Z)(this,"collateralValue","")}async handleDialogVisibility(t){await this.$nextTick(),this.collateralValue="",this.collateralInput?.focus()}get xorBalance(){return this.getFPNumberFromCodec(this.accountXor?.balance?.transferable??u.m8)}get title(){return this.t("kensetsu.addCollateral")}get networkFee(){return this.networkFees[i.Operation.DepositCollateral]}get fpNetworkFee(){return this.getFPNumberFromCodec(this.networkFee)}get networkFeeFormatted(){return this.formatCodecNumber(this.networkFee)}get isInsufficientXorForFee(){return this.xorBalance.sub(this.fpNetworkFee).isLtZero()}get isCollateralZero(){return(0,p.yA)(this.collateralValue)}get collateralFp(){return this.isCollateralZero?this.Zero:this.getFPNumber(this.collateralValue,this.lockedAsset?.decimals)}get isInsufficientBalance(){return!this.lockedAsset||(0,p.Vl)(this.lockedAsset,this.collateralValue,this.networkFee)}get disabled(){return this.loading||this.isInsufficientXorForFee||this.isCollateralZero||this.isInsufficientBalance}get collateralAssetBalance(){return(0,p.rh)(this.lockedAsset)}get availableCollateralBalanceFp(){let t=this.getFPNumberFromCodec(this.collateralAssetBalance);return this.lockedAsset?.address===o.XOR.address&&(t=t.sub(this.fpNetworkFee),t.isLtZero()&&(t=this.Zero)),t}get isMaxCollateralAvailable(){return!(!this.shouldBalanceBeHidden&&!this.isCollateralZero)||!this.availableCollateralBalanceFp.isLteZero()&&!this.collateralFp.isEqualTo(this.availableCollateralBalanceFp)}get collateralValuePercent(){if(!this.collateralValue)return 0;const t=this.collateralFp.div(this.availableCollateralBalanceFp).mul(u.Tv).toNumber(0);return t>u.Tv?u.Tv:t}get debtSymbol(){return this.debtAsset?.symbol??""}get lockedSymbol(){return this.lockedAsset?.symbol??""}get totalCollateralValue(){return this.vault?this.vault.lockedAmount.add(this.collateralValue||0):null}get formattedPrevDeposit(){return this.vault?this.vault.lockedAmount.toLocaleString():u.m8}get formattedNextDeposit(){return this.totalCollateralValue?.toLocaleString()??u.m8}get formattedPrevLtv(){return this.prevLtv?.toLocaleString(2)??u.m8}get maxBorrowPerCollateralValue(){if(this.isCollateralZero)return this.Zero;const t=this.averageCollateralPrice.mul(this.collateralValue).mul(this.collateral?.riskParams.liquidationRatioReversed??0).div(u.Tv);let e=t.sub(t.mul(this.borrowTax)),l=this.collateral?.riskParams.hardCap.sub(this.collateral.debtSupply)??this.Zero;return l=l.sub(l.mul(this.borrowTax)),e=e.gt(l)?l:e,!e.isFinity()||e.isLteZero()?this.Zero:e}get formattedPrevAvailable(){return this.prevAvailable.toLocaleString()}get nextAvailable(){return this.prevAvailable.add(this.maxBorrowPerCollateralValue)}get formattedNextAvailable(){return this.nextAvailable.toLocaleString()}get maxSafeDebt(){if(!this.totalCollateralValue)return null;return this.averageCollateralPrice.mul(this.totalCollateralValue).mul(this.collateral?.riskParams.liquidationRatioReversed??0).div(u.Tv)}get ltvCoeff(){return this.maxSafeDebt&&this.vault?this.vault.debt.div(this.maxSafeDebt):null}get ltv(){return this.ltvCoeff?.isFinity()?this.ltvCoeff.mul(u.Tv):null}get ltvNumber(){return this.ltv?this.ltv.toNumber():0}get formattedLtv(){return this.ltvCoeff?this.ltvCoeff.mul(this.maxLtv).toLocaleString(2):u.m8}get ltvText(){return d.ho[(0,h.D)(this.ltvNumber)]}handleCollateralPercentChange(t){this.collateralValue=this.availableCollateralBalanceFp.mul(t/u.Tv).toString()}handleMaxCollateralValue(){this.collateralValue=this.availableCollateralBalanceFp.toString()}get errorMessage(){let t="";return this.isInsufficientXorForFee?t=this.t("insufficientBalanceText",{tokenSymbol:this.xorSymbol}):this.isCollateralZero?t=this.t("kensetsu.error.enterCollateral"):this.isInsufficientBalance&&(t=this.t("insufficientBalanceText",{tokenSymbol:this.lockedSymbol})),t}async handleAddCollateral(){if(this.disabled)this.errorMessage&&this.$alert(this.errorMessage,{title:this.t("errorText")});else try{await this.withNotifications((async()=>{if(!this.vault||!this.lockedAsset)throw new Error("[api.kensetsu.depositCollateral]: vault or asset is null");await s.hi.kensetsu.depositCollateral(this.vault,this.collateralValue,this.lockedAsset)})),this.$emit("confirm")}catch(t){console.error(t)}this.isVisible=!1}};(0,r.gn)([(0,n.Rl)("collateralInput")],f.prototype,"collateralInput",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:u.u8})],f.prototype,"collateral",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:u.u8})],f.prototype,"vault",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:u.u8})],f.prototype,"lockedAsset",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:u.u8})],f.prototype,"debtAsset",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:()=>i.FPNumber.ZERO})],f.prototype,"prevLtv",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:()=>i.FPNumber.ZERO})],f.prototype,"prevAvailable",void 0),(0,r.gn)([(0,n.fI)({type:Object,default:()=>i.FPNumber.ZERO})],f.prototype,"averageCollateralPrice",void 0),(0,r.gn)([(0,n.fI)({type:Number,default:u.Tv})],f.prototype,"maxLtv",void 0),(0,r.gn)([(0,n.fI)({type:Number,default:0})],f.prototype,"borrowTax",void 0),(0,r.gn)([b.SB.wallet.settings.networkFees],f.prototype,"networkFees",void 0),(0,r.gn)([b.Yn.assets.xor],f.prototype,"accountXor",void 0),(0,r.gn)([(0,n.RL)("visible")],f.prototype,"handleDialogVisibility",null),f=(0,r.gn)([(0,n.wA)({components:{DialogBase:s.wx.DialogBase,InfoLine:s.wx.InfoLine,TokenInput:(0,v.kF)(u.z8.TokenInput),ValueStatus:(0,v.kF)(u.z8.ValueStatusWrapper),PrevNextInfoLine:(0,c.rP)(d.JB.PrevNextInfoLine)}})],f);var m=f,g=(0,l(1001).Z)(m,(function(){var t=this,e=t._self._c;t._self._setupProxy;return e("dialog-base",{attrs:{title:t.title,visible:t.isVisible,tooltip:t.t("kensetsu.addCollateralDescription")},on:{"update:visible":function(e){t.isVisible=e}}},[e("div",{staticClass:"add-collateral"},[e("token-input",{ref:"collateralInput",staticClass:"add-collateral__collateral-input add-collateral__token-input",attrs:{"with-slider":"",title:t.t("kensetsu.depositCollateral"),"is-fiat-editable":"","is-max-available":t.isMaxCollateralAvailable,token:t.lockedAsset,balance:t.collateralAssetBalance,"slider-value":t.collateralValuePercent,disabled:t.loading},on:{max:t.handleMaxCollateralValue,slide:t.handleCollateralPercentChange},model:{value:t.collateralValue,callback:function(e){t.collateralValue=e},expression:"collateralValue"}}),e("prev-next-info-line",{attrs:{label:t.t("kensetsu.totalCollateral"),tooltip:t.t("kensetsu.totalCollateralDescription"),symbol:t.lockedSymbol,prev:t.formattedPrevDeposit,next:t.formattedNextDeposit}}),e("prev-next-info-line",{attrs:{label:t.t("kensetsu.debtAvailable"),tooltip:t.t("kensetsu.debtAvailableDescription"),symbol:t.debtSymbol,prev:t.formattedPrevAvailable,next:t.formattedNextAvailable}}),e("prev-next-info-line",{attrs:{label:t.t("kensetsu.ltv"),tooltip:t.t("kensetsu.ltvDescription"),symbol:"%",prev:t.formattedPrevLtv,next:t.formattedLtv}},[t.ltv?e("value-status",{staticClass:"ltv-badge-status",attrs:{badge:"",value:t.ltvNumber,getStatus:t.getLtvStatus}},[t._v(" "+t._s(t.ltvText)+" ")]):t._e()],1),e("s-button",{staticClass:"s-typography-button--large action-button add-collateral__button",attrs:{type:"primary",disabled:t.disabled},on:{click:t.handleAddCollateral}},[t.disabled?[t._v(t._s(t.errorMessage))]:[t._v(t._s(t.title))]],2),e("info-line",{attrs:{label:t.t("networkFeeText"),"label-tooltip":t.t("networkFeeTooltipText"),value:t.networkFeeFormatted,"asset-symbol":t.xorSymbol,"fiat-value":t.getFiatAmountByCodecString(t.networkFee),"is-formatted":""}})],1)])}),[],!1,null,"32b50a94",null).exports}}]);